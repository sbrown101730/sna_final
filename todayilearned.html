<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Katie Lam">
<meta name="dcterms.date" content="2024-08-22">

<title>todayilearned_ergm</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="todayilearned_files/libs/clipboard/clipboard.min.js"></script>
<script src="todayilearned_files/libs/quarto-html/quarto.js"></script>
<script src="todayilearned_files/libs/quarto-html/popper.min.js"></script>
<script src="todayilearned_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="todayilearned_files/libs/quarto-html/anchor.min.js"></script>
<link href="todayilearned_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="todayilearned_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="todayilearned_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="todayilearned_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="todayilearned_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">todayilearned_ergm</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Katie Lam </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 22, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="load-packages" class="level2">
<h2 class="anchored" data-anchor-id="load-packages">Load packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Clear your environment</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Install packages below if you do not have them:</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"statnet"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()) <span class="fu">install.packages</span>(<span class="st">"statnet"</span>) <span class="co"># For fitting ERGMs</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"igraph"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()) <span class="fu">install.packages</span>(<span class="st">"igraph"</span>) <span class="co"># For network plotting</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"texreg"</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()) <span class="fu">install.packages</span>(<span class="st">"texreg"</span>) <span class="co"># For printing "nicer" model output</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statnet)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>() <span class="co"># List the files in the current working directory to see if you're in the right directory</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># read hyperlink tsv file</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>hyperlink_large <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"data/soc-redditHyperlinks-body.tsv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(source_subreddit, target_subreddit)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># read popularity csv file</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>popularity_large <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/subreddits_public.csv"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>popularity_clean <span class="ot">&lt;-</span> popularity_large <span class="sc">%&gt;%</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subreddit_name =</span> <span class="fu">str_to_lower</span>(subreddit_name))</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># find all subreddits with "todayilearned" as source or target</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>todayilearned_1 <span class="ot">&lt;-</span> hyperlink_large <span class="sc">%&gt;%</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(source_subreddit <span class="sc">==</span> <span class="st">"todayilearned"</span> <span class="sc">|</span> target_subreddit <span class="sc">==</span> <span class="st">"todayilearned"</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 layer: find all links from subreddits related to "todayilearned"</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>todayilearned_2 <span class="ot">&lt;-</span> hyperlink_large <span class="sc">%&gt;%</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(source_subreddit <span class="sc">%in%</span> todayilearned_1<span class="sc">$</span>source_subreddit <span class="sc">|</span> </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>           target_subreddit <span class="sc">%in%</span> todayilearned_1<span class="sc">$</span>target_subreddit <span class="sc">|</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>           source_subreddit <span class="sc">%in%</span> todayilearned_1<span class="sc">$</span>target_subreddit <span class="sc">|</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>           target_subreddit <span class="sc">%in%</span> todayilearned_1<span class="sc">$</span>source_subreddit)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co"># count # of links &lt;- take only n &gt; 35</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>todayilearned_3 <span class="ot">&lt;-</span> todayilearned_2 <span class="sc">%&gt;%</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(source_subreddit, target_subreddit) <span class="sc">%&gt;%</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">35</span>)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co"># clean popularity file</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>popularity <span class="ot">&lt;-</span> popularity_clean <span class="sc">%&gt;%</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(subreddit_name <span class="sc">%in%</span> todayilearned_3<span class="sc">$</span>source_subreddit <span class="sc">|</span> </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>           subreddit_name <span class="sc">%in%</span> todayilearned_3<span class="sc">$</span>target_subreddit) <span class="sc">%&gt;%</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subreddit_name, subscribers_count) <span class="sc">%&gt;%</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">subscribers_count =</span> <span class="fu">as.numeric</span>(subscribers_count),</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># categorical variable determining size of subreddit</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>      subscribers_count <span class="sc">&lt;=</span> <span class="dv">10000</span> <span class="sc">~</span> <span class="st">"small"</span>,</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>      subscribers_count <span class="sc">&lt;=</span> <span class="dv">50000</span> <span class="sc">~</span> <span class="st">"medium"</span>,</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>      subscribers_count <span class="sc">&gt;</span> <span class="dv">50000</span> <span class="sc">~</span> <span class="st">"large"</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># deal with NA values</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> size <span class="sc">%&gt;%</span> </span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">replace_na</span>(<span class="st">"missing"</span>)</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(subreddit_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="make-network" class="level2">
<h2 class="anchored" data-anchor-id="make-network">make network</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(todayilearned_3)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the edgelist to a network object in statnet format:</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>todayilearned_net <span class="ot">&lt;-</span> <span class="fu">as.network.matrix</span>(todayilearned_3, <span class="at">matrix.type =</span> <span class="st">"edgelist"</span>) </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(todayilearned_net)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>todayilearned_net <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  network<span class="sc">::</span><span class="fu">set.vertex.attribute</span>(<span class="st">"size"</span>, <span class="at">value =</span> popularity<span class="sc">$</span>size)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>network<span class="sc">::</span><span class="fu">get.vertex.attribute</span>(todayilearned_net,<span class="st">"vertex.names"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>network<span class="sc">::</span><span class="fu">get.vertex.attribute</span>(todayilearned_net,<span class="st">"size"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="make-igraph-object" class="level2">
<h2 class="anchored" data-anchor-id="make-igraph-object">make igraph object</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'igraph'</span>) <span class="co"># Ignore messages on any objects that are masked</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'igraph'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:lubridate':

    %--%, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:purrr':

    compose, simplify</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidyr':

    crossing</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tibble':

    as_data_frame</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    as_data_frame, groups, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:sna':

    betweenness, bonpow, closeness, components, degree, dyad.census,
    evcent, hierarchy, is.connected, neighborhood, triad.census</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:network':

    %c%, %s%, add.edges, add.vertices, delete.edges, delete.vertices,
    get.edge.attribute, get.edges, get.vertex.attribute, is.bipartite,
    is.directed, list.edge.attributes, list.vertex.attributes,
    set.edge.attribute, set.vertex.attribute</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    decompose, spectrum</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:base':

    union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set default plot options</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">igraph_options</span>(<span class="at">vertex.size =</span> <span class="dv">2</span>, <span class="at">vertex.color =</span> <span class="st">'grey'</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">edge.color=</span><span class="st">'gray80'</span>, <span class="at">edge.arrow.size=</span>.<span class="dv">1</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">vertex.label =</span> <span class="cn">NA</span>)                       </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># make an igraph network object from statnet network object</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>todayilearned_igraph <span class="ot">&lt;-</span> <span class="fu">graph.adjacency</span>(<span class="fu">as.matrix.network</span>(todayilearned_net)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `graph.adjacency()` was deprecated in igraph 2.0.0.
ℹ Please use `graph_from_adjacency_matrix()` instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set vertex attribute for size</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>todayilearned_igraph <span class="ot">&lt;-</span> <span class="fu">set_vertex_attr</span>(todayilearned_igraph, <span class="st">"popularity"</span>, <span class="at">value =</span> network<span class="sc">::</span><span class="fu">get.vertex.attribute</span>(todayilearned_net,<span class="st">"size"</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># count components</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">count_components</span>(todayilearned_igraph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 52</code></pre>
</div>
</div>
</section>
<section id="find-giant-component" class="level2">
<h2 class="anchored" data-anchor-id="find-giant-component">find giant component</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>reddit_comp <span class="ot">&lt;-</span> igraph<span class="sc">::</span><span class="fu">components</span>(todayilearned_igraph)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>giantGraph_todayilearned <span class="ot">&lt;-</span> todayilearned_igraph <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">induced_subgraph</span>(., <span class="fu">which</span>(reddit_comp<span class="sc">$</span>membership <span class="sc">==</span> <span class="fu">which.max</span>(reddit_comp<span class="sc">$</span>csize)))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(giantGraph_todayilearned)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="todayilearned_files/figure-html/giant%20component-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(intergraph)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>todayilearned_giant <span class="ot">&lt;-</span> <span class="fu">asNetwork</span>(giantGraph_todayilearned)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>todayilearned_giant</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Network attributes:
  vertices = 134 
  directed = TRUE 
  hyper = FALSE 
  loops = FALSE 
  multiple = FALSE 
  bipartite = FALSE 
  total edges= 214 
    missing edges= 0 
    non-missing edges= 214 

 Vertex attribute names: 
    popularity vertex.names 

No edge attributes</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vcount(gpt_graph) ## the number of nodes/actors/users</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ecount(gpt_graph) ## the number of edges</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ergm-summaries" class="level2">
<h2 class="anchored" data-anchor-id="ergm-summaries">ergm summaries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statnet)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">ergm.loglik.warn_dyads=</span><span class="cn">FALSE</span>) </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at Endogenous statistics: terms based on only ties in the advice network</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(todayilearned_giant <span class="sc">~</span> edges)                     <span class="co"># Number of edges (ties)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>edges 
  214 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(todayilearned_giant <span class="sc">~</span> mutual)                    <span class="co"># Number of pairs of reciprocated ties</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mutual 
    10 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(todayilearned_giant <span class="sc">~</span> <span class="fu">idegree</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">65</span>))             <span class="co"># Indegree distribution.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> idegree0  idegree1  idegree2  idegree3  idegree4  idegree5  idegree6  idegree7 
       63        36        13         5         4         2         1         2 
 idegree8  idegree9 idegree10 idegree11 idegree12 idegree13 idegree14 idegree15 
        4         0         2         0         1         0         0         0 
idegree16 idegree17 idegree18 idegree19 idegree20 idegree21 idegree22 idegree23 
        0         0         0         0         0         0         0         0 
idegree24 idegree25 idegree26 idegree27 idegree28 idegree29 idegree30 idegree31 
        0         0         0         1         0         0         0         0 
idegree32 idegree33 idegree34 idegree35 idegree36 idegree37 idegree38 idegree39 
        0         0         0         0         0         0         0         0 
idegree40 idegree41 idegree42 idegree43 idegree44 idegree45 idegree46 idegree47 
        0         0         0         0         0         0         0         0 
idegree48 idegree49 idegree50 idegree51 idegree52 idegree53 idegree54 idegree55 
        0         0         0         0         0         0         0         0 
idegree56 idegree57 idegree58 idegree59 idegree60 idegree61 idegree62 idegree63 
        0         0         0         0         0         0         0         0 
idegree64 idegree65 
        0         0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(todayilearned_giant <span class="sc">~</span> <span class="fu">gwodegree</span>(<span class="fu">log</span>(<span class="dv">2</span>),<span class="at">fixed=</span>T)) <span class="co"># One parameter summarizing outdegree distribution - tendency against outdegree hubs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>gwodeg.fixed.0.693147180559945 
                      119.3723 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(todayilearned_giant <span class="sc">~</span> <span class="fu">gwidegree</span>(<span class="fu">log</span>(<span class="dv">2</span>),<span class="at">fixed=</span>T)) <span class="co"># One parameters summarizing indegree distribution - tendency against indegree hubs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>gwideg.fixed.0.693147180559945 
                      97.52686 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(todayilearned_giant <span class="sc">~</span> <span class="fu">desp</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>esp.OTP1 esp.OTP2 esp.OTP3 esp.OTP4 esp.OTP5 
      48       10        0        0        0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>todayilearned_giant</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Network attributes:
  vertices = 134 
  directed = TRUE 
  hyper = FALSE 
  loops = FALSE 
  multiple = FALSE 
  bipartite = FALSE 
  total edges= 214 
    missing edges= 0 
    non-missing edges= 214 

 Vertex attribute names: 
    popularity vertex.names 

No edge attributes</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove missing</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(todayilearned_giant <span class="sc">~</span> <span class="fu">nodematch</span>(<span class="st">"popularity"</span>, <span class="at">levels =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">diff =</span> <span class="cn">TRUE</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> nodematch.popularity.large nodematch.popularity.medium 
                         55                           6 
 nodematch.popularity.small 
                          9 </code></pre>
</div>
</div>
<section id="fit-model-1" class="level3">
<h3 class="anchored" data-anchor-id="fit-model-1">fit model 1</h3>
<p><strong>Hypothesis to consider</strong></p>
</section>
</section>
<section id="subreddits-have-a-tendency-to-form-more-ties-than-a-random-network" class="level2">
<h2 class="anchored" data-anchor-id="subreddits-have-a-tendency-to-form-more-ties-than-a-random-network">1. Subreddits have a tendency to form more ties than a random network</h2>
</section>
<section id="subreddits-are-likely-to-have-reciprocal-ties" class="level2">
<h2 class="anchored" data-anchor-id="subreddits-are-likely-to-have-reciprocal-ties">2. Subreddits are likely to have reciprocal ties</h2>
</section>
<section id="subreddits-have-a-preferential-indegree-attachement-want-to-determine-whether-todayilearned-is-a-hub-or-an-authority-node." class="level2">
<h2 class="anchored" data-anchor-id="subreddits-have-a-preferential-indegree-attachement-want-to-determine-whether-todayilearned-is-a-hub-or-an-authority-node.">3. Subreddits have a preferential indegree attachement –&gt; want to determine whether todayilearned is a hub or an authority node.</h2>
</section>
<section id="subreddits-have-a-tendency-to-form-more-ties-based-on-subreddits-with-the-same-size." class="level2">
<h2 class="anchored" data-anchor-id="subreddits-have-a-tendency-to-form-more-ties-based-on-subreddits-with-the-same-size.">4. Subreddits have a tendency to form more ties based on subreddits with the same size.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following commands do model estimation for ERGMs.</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This may take a second. Text will print in-console to update you on progress in model estimation.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">ergm</span>(todayilearned_giant <span class="sc">~</span> edges</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>               <span class="sc">+</span> mutual </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>               <span class="sc">+</span> <span class="fu">gwidegree</span>(<span class="fu">log</span>(<span class="dv">2</span>),<span class="at">fixed=</span>T)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>               <span class="sc">+</span> <span class="fu">nodematch</span>(<span class="st">"popularity"</span>, <span class="at">levels =</span> <span class="sc">-</span><span class="dv">3</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>               </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>               , <span class="at">control =</span> <span class="fu">control.ergm</span>(<span class="at">seed =</span> <span class="dv">42</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>               , <span class="at">verbose =</span> F</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 'glpk' selected as the solver, but package 'Rglpk' is not available;
falling back to 'lpSolveAPI'. This should be fine unless the sample size and/or
the number of parameters is very big.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
ergm(formula = todayilearned_giant ~ edges + mutual + gwidegree(log(2), 
    fixed = T) + nodematch("popularity", levels = -3), control = control.ergm(seed = 42), 
    verbose = F)

Monte Carlo Maximum Likelihood Results:

                               Estimate Std. Error MCMC % z value Pr(&gt;|z|)    
edges                          -3.20988    0.08863      0 -36.217   &lt;1e-04 ***
mutual                          2.19073    0.35272      0   6.211   &lt;1e-04 ***
gwideg.fixed.0.693147180559945 -3.09622    0.22202      0 -13.946   &lt;1e-04 ***
nodematch.popularity           -0.22093    0.12788      0  -1.728   0.0841 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     Null Deviance: 24707  on 17822  degrees of freedom
 Residual Deviance:  2115  on 17818  degrees of freedom
 
AIC: 2123  BIC: 2154  (Smaller is better. MC Std. Err. = 0.9467)</code></pre>
</div>
</div>
</section>
<section id="display-results-of-model-1" class="level1">
<h1>display results of model 1</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(texreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Version:  1.39.4
Date:     2024-07-23
Author:   Philip Leifeld (University of Manchester)

Consider submitting praise using the praise or praise_interactive functions.
Please cite the JSS article in your publications -- see citation("texreg").</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'texreg'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidyr':

    extract</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">screenreg</span>(<span class="fu">list</span>(<span class="st">"model1"</span><span class="ot">=</span>model1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
============================================
                                model1      
--------------------------------------------
edges                              -3.21 ***
                                   (0.09)   
mutual                              2.19 ***
                                   (0.35)   
gwideg.fixed.0.693147180559945     -3.10 ***
                                   (0.22)   
nodematch.popularity               -0.22    
                                   (0.13)   
--------------------------------------------
AIC                              2123.19    
BIC                              2154.34    
Log Likelihood                  -1057.59    
============================================
*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05</code></pre>
</div>
</div>
<p>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc.diagnostics</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="todayilearned_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Sample statistics summary:

Iterations = 120832:2379776
Thinning interval = 2048 
Number of chains = 1 
Sample size per chain = 1104 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

                                   Mean     SD Naive SE Time-series SE
edges                          -3.20290 30.881   0.9294         2.1237
mutual                         -0.08967  3.949   0.1188         0.2818
gwideg.fixed.0.693147180559945 -0.65719 10.550   0.3175         0.6961
nodematch.popularity           -1.27899 12.614   0.3796         0.6724

2. Quantiles for each variable:

                                 2.5%     25%     50%    75% 97.5%
edges                          -62.42 -24.000 -4.0000 17.000 60.00
mutual                          -7.00  -3.000  0.0000  2.000  9.00
gwideg.fixed.0.693147180559945 -20.94  -7.438 -0.7478  5.869 20.77
nodematch.popularity           -24.00 -10.000 -2.0000  7.000 25.00


Are sample statistics significantly different from observed?
                edges      mutual gwideg.fixed.0.693147180559945
diff.      -3.2028986 -0.08967391                     -0.6571927
test stat. -1.5081996 -0.31818983                     -0.9441696
P-val.      0.1315035  0.75034095                      0.3450830
           nodematch.popularity       (Omni)
diff.                -1.2789855           NA
test stat.           -1.9020983 15.880370143
P-val.                0.0571583  0.003637048

Sample statistics cross-correlations:
                                   edges    mutual
edges                          1.0000000 0.6935266
mutual                         0.6935266 1.0000000
gwideg.fixed.0.693147180559945 0.9028960 0.6305362
nodematch.popularity           0.7802955 0.5144674
                               gwideg.fixed.0.693147180559945
edges                                               0.9028960
mutual                                              0.6305362
gwideg.fixed.0.693147180559945                      1.0000000
nodematch.popularity                                0.7329335
                               nodematch.popularity
edges                                     0.7802955
mutual                                    0.5144674
gwideg.fixed.0.693147180559945            0.7329335
nodematch.popularity                      1.0000000

Sample statistics auto-correlation:
Chain 1 
              edges    mutual gwideg.fixed.0.693147180559945
Lag 0     1.0000000 1.0000000                      1.0000000
Lag 2048  0.6411139 0.6331044                      0.5227290
Lag 4096  0.4189474 0.4699864                      0.3075395
Lag 6144  0.3005419 0.3560541                      0.2177127
Lag 8192  0.2528338 0.2818786                      0.1827876
Lag 10240 0.1623630 0.2462440                      0.1159968
          nodematch.popularity
Lag 0               1.00000000
Lag 2048            0.44529349
Lag 4096            0.27179656
Lag 6144            0.15693568
Lag 8192            0.11208154
Lag 10240           0.03080398

Sample statistics burn-in diagnostic (Geweke):
Chain 1 

Fraction in 1st window = 0.1
Fraction in 2nd window = 0.5 

                         edges                         mutual 
                     0.5264903                      0.8989994 
gwideg.fixed.0.693147180559945           nodematch.popularity 
                     0.6900060                      0.5950951 

Individual P-values (lower = worse):
                         edges                         mutual 
                     0.5985476                      0.3686530 
gwideg.fixed.0.693147180559945           nodematch.popularity 
                     0.4901904                      0.5517799 
Joint P-value (lower = worse):  0.882297 

Note: MCMC diagnostics shown here are from the last round of
  simulation, prior to computation of final parameter estimates.
  Because the final estimates are refinements of those used for this
  simulation run, these diagnostics may understate model performance.
  To directly assess the performance of the final model on in-model
  statistics, please use the GOF command: gof(ergmFitObject,
  GOF=~model).</code></pre>
</div>
</div>
<section id="perform-goodness-of-fit-test-to-check-how-well-the-estimated-model-captures-certain-statistical-features-of-the-observed-network-for-both-model-1-and-2.-10-pts" class="level2">
<h2 class="anchored" data-anchor-id="perform-goodness-of-fit-test-to-check-how-well-the-estimated-model-captures-certain-statistical-features-of-the-observed-network-for-both-model-1-and-2.-10-pts">2. Perform Goodness of Fit test to check how well the estimated model captures certain statistical features of the observed network for both model 1 and 2. <strong>(10 pts)</strong></h2>
<ol type="a">
<li>To do so, simulate many networks from the estimated model and extract 100 samples from the simulation process. Please note, this may take 2 minutes or more to compute.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>sim1 <span class="ot">&lt;-</span> <span class="fu">simulate</span>(model1, <span class="at">burnin=</span><span class="dv">100000</span>, <span class="at">interval=</span><span class="dv">100000</span>, <span class="at">nsim=</span><span class="dv">100</span>, <span class="at">verbose=</span>T)  <span class="co"># Uses the ergm model to simulate a null model</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the first of the simulated networks</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>sim1_net1 <span class="ot">&lt;-</span> igraph<span class="sc">::</span><span class="fu">graph.adjacency</span>(<span class="fu">as.matrix.network</span>(sim1[[<span class="dv">1</span>]]))</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">plot.igraph</span>(sim1_net1,<span class="at">edge.color=</span><span class="st">"brown"</span>,  </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">vertex.color =</span> <span class="st">'grey'</span>,<span class="at">edge.arrow.size=</span>.<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="todayilearned_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the 10th simulated network</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>sim1_net10 <span class="ot">&lt;-</span> igraph<span class="sc">::</span><span class="fu">graph.adjacency</span>(<span class="fu">as.matrix.network</span>(sim1[[<span class="dv">10</span>]]))</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">plot.igraph</span>(sim1_net10,<span class="at">edge.color=</span><span class="st">"red"</span>,  </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">vertex.color =</span> <span class="st">'grey'</span>,<span class="at">edge.arrow.size=</span>.<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="todayilearned_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="a">
<li>Extract the number of triangles from each of the 100 samples.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------------------------------------</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the number of triangles from each of the 100 samples and</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># compare the distribution of triangles in the sampled networks with the observed network</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------------------------------------</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1:</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>model1.tridist <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="cf">function</span>(x) <span class="fu">summary</span>(sim1[[x]] <span class="sc">~</span>triangle)) <span class="co"># Extracts the triangle data from the simulated networks</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(model1.tridist,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1000</span>),<span class="at">breaks=</span><span class="dv">10</span>)                             <span class="co"># Plots that triangle distribution as a histogram, change xlim to change the x-axis range if necessary</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>advice.tri <span class="ot">&lt;-</span> <span class="fu">summary</span>(todayilearned_net <span class="sc">~</span> triangle)                                    <span class="co"># Stores the number of observed triangles</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>advice.tri</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>triangle 
      70 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(advice.tri,<span class="dv">20</span>, advice.tri, <span class="fl">0.5</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">3</span>)                      <span class="co"># Adds an arrow to the plotted histogram</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="todayilearned_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">obs=</span>advice.tri,<span class="at">mean=</span><span class="fu">mean</span>(model1.tridist),<span class="at">sd=</span><span class="fu">sd</span>(model1.tridist),</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">tstat=</span><span class="fu">abs</span>(<span class="fu">mean</span>(model1.tridist)<span class="sc">-</span>advice.tri)<span class="sc">/</span><span class="fu">sd</span>(model1.tridist))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  obs.triangle           mean             sd tstat.triangle 
     70.000000      15.100000       9.169008       5.987562 </code></pre>
</div>
</div>
<ol start="3" type="a">
<li>Compare the distribution of triangles in the sampled networks with the observed network by generating a histogram of the triangles. Interpret your result – is the estimated model a good one in terms of triangle measure?</li>
</ol>
<p>The histogram of triangles shows that model 1 does not have that good of a fit for triangle measure because our observed model does not land in the distribution of random sampled networks. The t-stat is 6.784396 which is a bad fit. The boxplot created from the code below for <code>edgewise shared partners</code> also shows that the observed network does not align well with the other generated networks. This GOF calculation shows us that the goodness of fit for <code>edgewise shared partners</code> have an average low p-value (some values are 0), which we can use to conclude that model 1 is not good to measure triangles in the network. However, for the histogram of model 2, our observed network fits inside of the distribution which indicates that it is a good model in terms of triangle measure. Here, the t-stat is 0.2754067, which is between 0.1 and 1, signifying a good fit. Additionally the p-values for <code>edgewise shared partners</code> are also high and the distribution boxplot for <code>edgewise shared partners</code> matches mostly well with the observed data, indicating that the goodness of fit is good for model 2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------------------------------------</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Test the goodness of fit of the model</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compiles statistics for these simulations as well as the observed network, and calculates p-values </span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------------------------------------</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1:</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co"># It may take a second for this command to run.</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>gof1 <span class="ot">&lt;-</span> <span class="fu">gof</span>(model1, <span class="at">verbose=</span>T, <span class="at">burnin=</span><span class="fl">1e+5</span>, <span class="at">interval=</span><span class="fl">1e+5</span>, <span class="at">control =</span> <span class="fu">control.gof.ergm</span>(<span class="at">nsim =</span> <span class="dv">200</span>))</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co"># If you run below and then wouldn't see the plot, try par(mar=c(2,2,2,2))</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()           <span class="co"># Clear any other plots from the plot window</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>null device 
          1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gof1)          <span class="co"># Plot the goodness of fit</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Note: This should produce five separate plots that you should look through.</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#       In RStudio, scroll between the plots using the arrow buttons</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>gof1                <span class="co"># Display the goodness of fit info in the console</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Goodness-of-fit for in-degree 

          obs min   mean max MC p-value
idegree0   63  58 71.245  90       0.24
idegree1   36   8 17.300  27       0.00
idegree2   13   2 10.325  19       0.46
idegree3    5   2  8.305  16       0.27
idegree4    4   1  7.325  17       0.29
idegree5    2   1  6.275  17       0.17
idegree6    1   0  5.000  14       0.07
idegree7    2   0  3.505   9       0.68
idegree8    4   0  2.350   8       0.40
idegree9    0   0  1.265   5       0.56
idegree10   2   0  0.595   3       0.21
idegree11   0   0  0.355   3       1.00
idegree12   1   0  0.105   1       0.21
idegree13   0   0  0.035   1       1.00
idegree14   0   0  0.015   1       1.00
idegree27   1   0  0.000   0       0.00

Goodness-of-fit for out-degree 

          obs min   mean max MC p-value
odegree0   39   8 26.300  47       0.10
odegree1   64  25 42.435  61       0.00
odegree2   10  16 34.750  49       0.00
odegree3    3   4 19.085  36       0.00
odegree4    4   1  7.675  16       0.37
odegree5    4   0  2.715   9       0.63
odegree6    3   0  0.790   7       0.12
odegree7    0   0  0.175   2       1.00
odegree8    4   0  0.065   1       0.00
odegree9    0   0  0.010   1       1.00
odegree10   1   0  0.000   0       0.00
odegree12   1   0  0.000   0       0.00
odegree13   1   0  0.000   0       0.00

Goodness-of-fit for edgewise shared partner 

         obs min    mean max MC p-value
esp.OTP0 156 121 207.510 275       0.05
esp.OTP1  48   2  12.005  31       0.00
esp.OTP2  10   0   0.520   3       0.00
esp.OTP3   0   0   0.005   1       1.00

Goodness-of-fit for minimum geodesic distance 

      obs  min      mean   max MC p-value
1     214  129   220.040   294       0.90
2     344  116   382.485   750       0.76
3     111   83   572.115  1405       0.01
4       5   47   686.805  1714       0.00
5       0    7   648.430  1521       0.00
6       0    0   509.265  1089       0.01
7       0    0   354.800   739       0.01
8       0    0   232.810   577       0.01
9       0    0   145.640   412       0.01
10      0    0    86.775   337       0.06
11      0    0    50.400   227       0.20
12      0    0    27.280   199       0.45
13      0    0    14.000   154       0.76
14      0    0     7.370   109       1.00
15      0    0     4.105    77       1.00
16      0    0     2.300    58       1.00
17      0    0     1.145    31       1.00
18      0    0     0.480    17       1.00
19      0    0     0.160     9       1.00
20      0    0     0.040     3       1.00
21      0    0     0.010     1       1.00
Inf 17148 9884 13875.545 17440       0.01

Goodness-of-fit for model statistics 

                                     obs       min      mean      max
edges                          214.00000 129.00000 220.04000 294.0000
mutual                          10.00000   2.00000  10.72500  21.0000
gwideg.fixed.0.693147180559945  97.52686  65.44141  99.42755 122.1812
nodematch.popularity            70.00000  41.00000  72.80500 113.0000
                               MC p-value
edges                                0.90
mutual                               0.99
gwideg.fixed.0.693147180559945       0.85
nodematch.popularity                 0.86</code></pre>
</div>
</div>
<section id="endogenous-effects-effects-of-the-ties-being-predicted-on-other-predicted-ties" class="level3">
<h3 class="anchored" data-anchor-id="endogenous-effects-effects-of-the-ties-being-predicted-on-other-predicted-ties">Endogenous Effects (Effects of the ties being predicted on other predicted ties)</h3>
<p>● <strong><em>edges</em></strong>: number of edges in the network</p>
<p>● <strong><em>mutual</em>:</strong> number of reciprocal edges in the network</p>
<p>●&nbsp; <em><strong>gwidegree</strong>: Geometrically Weighted Indegree</em>. This term measures a tendency <em>against</em> indegree preferential attachment. (Negative coefficients show indegree preferential attachment – Incoming ties are more likely to be directed towards nodes that already have other incoming ties.)</p>
<p>● <em><strong>gwodegree</strong>: Directed Geometrically Weighted Outdegree.</em> This term measures a tendency <em>against</em> outdegree preferential attachment. (Negative coefficients show outdegree preferential attachment – Outgoing ties are more likely to originate from nodes that already have other outgoing ties)</p>
<p>● <em><strong>dgwesp</strong>, of type “OTP”</em>: <em>Directed Geometrically Weighted Edgewise Shared Partners</em> Number of edges that belong to certain types of triangles. “Edgewise” refers to the fact that we require a tie to exist between nodes i and j, and then measure the number of “shared partners” between them. Shared partners are nodes that have a certain relationship between i and j. In this case, we are looking at the Outgoing Two Path (“OTP”) relationships. This is one way to operationalize transitivity. The “geometrically weighted” refers to the fact that we will use a weight parameter,, to add diminishing returns to the number of shared partners (i.e., the second shared partner between two nodes will have less effect on the likelihood of a network than the first shared partner, the third will have even less of an effect, and so on).</p>
<p>Yes, geometrically weighted terms (gwidegree, gwodegree, dgwesp) are very complicated. Essentially, the “geometric weighted” part is saying that effects on network probability have diminishing returns for nodes as degree or the number of shared partners gets higher and higher. This helps avoid model fits where all the ties are directed towards one node. For the purposes of this class, you can ignore the technical details and just focus on interpreting them in terms of “preferential attachment” or “transitivity” effects.</p>
</section>
<section id="exogenous-effects-effects-of-node-attributes-or-variables-outside-the-predicted-ties" class="level3">
<h3 class="anchored" data-anchor-id="exogenous-effects-effects-of-node-attributes-or-variables-outside-the-predicted-ties"><strong>Exogenous Effects (Effects of node attributes or variables outside the predicted ties)</strong></h3>
<p>● <strong><em>nodeicov</em></strong>: covariance between in-degree of nodes and attributes of nodes</p>
<p>● <strong><em>nodeocov</em></strong>: covariance between out-degree of nodes and attributes of nodes</p>
<p>● <strong><em>diff</em></strong>: differences between nodes on some numeric attribute (ex. tenure, age). The way we have it specified in the code, diff scores are is calculated as the attribute value of the sending node (attb<sub>i</sub>) minus value of the receiving node (attb<sub>j</sub>). (Heterophily/ anti-homophily on continuous variables).</p>
<p>● <em><strong>nodematc</strong>h</em>: tendency of nodes to form ties with those of matching values (Homophily on categorical variables)</p>
<p>● <strong><em>nodemix</em></strong>: mixing matrix of all different combinations of node attributes (ex. A -&gt; A ties, A-&gt; B ties, B -&gt; A ties, B -&gt; B ties). To avoid model overspecification, we need to leave one of these cells out of the model. The weights (effect sizes) estimated for all of the terms we leave in the model then represent the effect of a combination relative to the effect that we left out.</p>
<p>● <strong><em>edgecov</em></strong>: covariance between edges of two networks (the presence/strength of a tie in an outside network on whether a tie exists in our dependent variable network – Advice)</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>